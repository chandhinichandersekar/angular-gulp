machine:
  services:
    - docker

dependencies:
  override:
    - docker info

test:
  override:
    - docker build -t tquinlan1992/angulargulp:$CIRCLE_BRANCH .
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker push tquinlan1992/angulargulp:$CIRCLE_BRANCH

deployment:
  master:
      branch: master
      commands:
        - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
        - docker tag tquinlan1992/angulargulp:{master,`git describe`}
        - docker tag tquinlan1992/angulargulp:{master,latest}
        - docker push tquinlan1992/angulargulp:`git describe`
        - docker push tquinlan1992/angulargulp:latest
