
machine:
  services:
    - docker

dependencies:
  override:
    - docker info

test:
  override:
    - docker build --rm=false -t tquinlan/angulargulp:$CIRCLE_BRANCH .
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker push tquinlan/angulargulp:$CIRCLE_BRANCH

deployment:
  master:
      branch: master
      commands:
        - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
        - docker tag tquinlan/angulargulp:{master,`git describe`}
        - docker tag tquinlan/angulargulp:{master,latest}
        - docker push tquinlan/angulargulp:`git describe`
        - docker push tquinlan/angulargulp:latest
